<aside class="steps-sidebar" [class.mobile-open]="mobileOpen">
  <div class="sidebar-header">
    <div class="header-content">
      <h3 class="sidebar-title">All Steps</h3>
      <button class="close-button" (click)="closeSidebar.emit()" aria-label="Close sidebar">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <nav class="sidebar-nav">
    <ul class="steps-list">
      @for (step of steps; track step.id; let i = $index) {
        <li
          class="step-item"
          [class.current]="i === currentStepIndex"
          [class.completed]="isStepComplete(step)"
          [class.locked]="step.locked && !isUnlockedAll"
          [class.clickable]="canNavigateToStep(step)"
          (click)="onStepClick(i)"
        >
          <div class="step-item-content">
            <div class="step-number-container">
              @if (isStepComplete(step)) {
                <!-- Completed checkmark -->
                <div class="step-icon completed-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              } @else if (step.locked && !isUnlockedAll) {
                <!-- Locked icon -->
                <div class="step-icon locked-icon">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2"/>
                    <path d="M7 11V7C7 4.79086 8.79086 3 11 3H13C15.2091 3 17 4.79086 17 7V11" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </div>
              } @else {
                <!-- Step number -->
                <span class="step-number">{{ i + 1 }}</span>
              }
            </div>

            <div class="step-details">
              <h4 class="step-title">{{ step.topic }}</h4>
              <div class="step-progress">
                <span class="progress-text">
                  {{ getCompletedSubtasksCount(step) }}/{{ step.subTasks.length }} tasks
                </span>
              </div>
            </div>
          </div>

          @if (i === currentStepIndex) {
            <div class="current-indicator"></div>
          }
        </li>
      }
    </ul>
  </nav>
</aside>
